import:
  - recipe/laravel.php
  - contrib/crontab.php
  - contrib/npm.php
  - deploy/website.php

config:
  application: 'oliver.mx'
  repository: 'git@github.com:oliverds/oliver.mx.git'
  branch: 'master'
  http_user: forge
  remote_user: forge

hosts:
  production:
    hostname: 216.238.80.135
    deploy_path: '~/oliver.mx'

tasks:
  provision:
    - provision:check
    - provision:configure
    - provision:update
    - provision:upgrade
    - provision:install
    - provision:ssh
    - provision:firewall
    - provision:deployer
    - provision:server
    - provision:php
    - provision:php-extra
    - provision:databases
    - provision:redis
    - provision:supervisor
    - provision:composer
    - provision:npm
    - provision:website
    - provision:verify
  deploy:
    - deploy:prepare
    - deploy:vendors
    - artisan:storage:link
    - artisan:view:cache
    - artisan:config:cache
    - npm:install
    - npm:run:prod
    - deploy:publish
  npm:run:prod:
    - run: 'cd {{release_or_current_path}} && npm run prod'

after:
  deploy:failed: deploy:unlock
  deploy:success: crontab:sync
